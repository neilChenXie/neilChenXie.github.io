---
title: git 怎么去掉一些不重要的中间commit
date: '2026-01-05 14:46:46'
permalink: /post/how-to-remove-some-unimportant-intermediate-commits-in-git-rjaux.html
tags:
  - git
  - github
categories:
  - Software Development｜软件开发
layout: post
published: true
---



## 摘要

在Git中清理提交历史，去除不重要的中间commit，是代码整理中的常见需求。以下是几种核心方法及其操作流程，你可以根据实际情况选择。

### Git Rebase案例：当分支提交了Commit，主干也有新的Commit

参考：

- [git rebase: 人生无法重来，但代码可以！](https://www.bilibili.com/video/BV1Xb4y1773F)
- [git rebase 情景图表+代码演示](https://www.bilibili.com/video/BV1GpqsYREeP)

![image](https://chenxie-fun.oss-cn-shenzhen.aliyuncs.com/work/image-20251216155650-jrpf1y0.png)

结论，在此情况下，使用`git rebase`​好过`git merge main`。

<span data-type="text" style="color: var(--b3-font-color8);">黄金原则：不要使用rebase处理已经被其他人引用的提交。</span>

引申，`git rebase -i`常用命令：pick、rework、squash、drop

![image](https://chenxie-fun.oss-cn-shenzhen.aliyuncs.com/work/image-20251216160909-8nle2oc.png)

## 操作

### 💎 方案一：交互式变基（Rebase）

这是最强大和常用的方法，特别适用于​**尚未推送到远程仓库的本地提交**。它可以精确地删除、合并、修改提交。

1. **启动交互式变基**

   使用 `git rebase -i [commit_id]`​命令，其中 `[commit_id]`是你要修改的提交范围之前的一个提交ID。例如，要修改最近3次提交，可以使用：

   ```
   git rebase -i HEAD~3
   ```

   这会打开一个编辑器，按时间倒序列出提交列表（最旧的排在最前面）。
2. **编辑变基指令**

   在打开的编辑器中，你将看到每行以一个命令（如 `pick`）开头，后面是提交的哈希值和提交信息。将这些命令修改为你想要的操作：

   - ​**​`drop`​**​ **(或** **​`d`​**​ **)** ​: 直接**删除**该提交。在要删除的提交行前，将 `pick`​改为 `drop`或直接删除该行。
   - ​**​`squash`​**​ **(或** **​`s`​**​ **)** ​: **合并**提交。将该提交合并到前一个提交中，并允许你重新编辑提交信息。这对于将多个小提交合并成一个有意义的提交非常有用。
   - ​**​`fixup`​**​ **(或** **​`f`​**​ **)** ​: 与 `squash`​类似，但会**丢弃**当前提交的提交信息，直接使用前一个提交的信息。

     编辑完成后保存并关闭编辑器。
3. **处理冲突与完成**

   如果重新应用提交时出现冲突，Git会暂停并提示你解决。解决冲突后，使用 `git add`​标记冲突已解决，然后执行 `git rebase --continue`​继续。如果想中止整个变基操作，使用 `git rebase --abort`。
4. **更新远程仓库（如需）**

   ​**警告**​：因为变基操作​**重写了提交历史**，如果你要更新已经推送到远程仓库的提交，必须使用强制推送：

   ```
   git push --force-with-lease
   ```

   ​ **​`--force-with-lease`​**​**比**  **​`--force`​**​**更安全**​，它会检查远程分支是否有其他人推送了新的提交，避免覆盖他人的工作。**请务必确保你是唯一在此分支上工作的人。**

### 🔄 方案二：反转提交（Revert）

如果你的提交​**已经推送到公共仓库**​，为了避免重写历史给协作者带来麻烦，`git revert`​是更安全的选择。它通过创建一个**新的提交**来撤销指定提交的更改。

1. **执行反转**

   找到你想要撤销的提交的哈希值（ID），然后执行：

   ```
   git revert <commit_id>
   ```
2. **处理冲突与提交**

   如果反转过程中出现冲突，解决后使用 `git add`​并 `git commit`提交。即使没有冲突，Git也可能直接为你创建一个新的反转提交，你可以编辑提交信息。
3. **推送到远程**

   由于这是新增的提交，直接使用普通推送即可：

   ```
   git push
   ```

   这种方法的优点是​**不会修改已有的历史**，只是添加新的“修正”记录，对公共历史非常安全。缺点是历史记录中会多出一些反转提交，看起来不那么线性。

### 💡 核心注意事项

- ​**黄金法则**​：​**只对尚未推送到公共仓库的本地提交进行变基操作**​。对于已经共享的提交，优先考虑使用 `git revert`。
- ​**备份习惯**​：在进行任何历史修改操作前，如果担心操作失误，可以使用 `git reflog`命令查看所有操作记录，它像一张安全网，允许你通过提交哈希值重置到操作之前的状态。
- ​**团队沟通**：如果你修改了已经推送到共享仓库的历史，务必通知团队中的其他成员，因为他们本地的历史副本会与远程仓库不一致，需要他们进行相应的调整。

### 如何选择？

|场景|推荐方法|理由|
| ------| ----------| ----------------------------------------------------|
|**提交仅在本地，未推送**|**交互式变基 (**​**​`rebase -i`​**​ **)** |可以创造最清晰、线性的历史。|
|**提交已推送到公共仓库**|**反转提交 (**​**​`revert`​**​ **)** |安全，避免重写公共历史，防止给协作者带来困扰。|
|**需要删除的提交是最近的几个**|**软重置 (**​**​`reset --soft`​**​ **)** |快速撤回提交，同时保留更改在工作区，方便重新提交。|

希望这些详细的解释能帮助你更自信地整理Git历史。如果你能具体说明一下你想清理的提交是处于本地还是远程状态，我可以给你更精确的操作建议。
